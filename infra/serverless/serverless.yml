service: finance-tracker-api

provider:
  name: aws
  runtime: python3.13
  region: eu-north-1
  profile: Personal
  stage: default
  vpc:
    securityGroupIds:
      - ${ssm:/finance-tracker/default/lambda/sg}
    subnetIds:
      - ${ssm:/finance-tracker/default/subnet/private-a}
      - ${ssm:/finance-tracker/default/subnet/private-b}
  environment:
    DB_ENDPOINT: ${ssm:/finance-tracker/default/db/endpoint}
    DB_NAME: ${ssm:/finance-tracker/default/db/name}
    DB_USER: ${ssm:/finance-tracker/default/db/user}
    DB_PASSWORD: ${ssm-secure:/finance-tracker/default/db/password}
  iam:
    role:
      statements:
        - Effect: Allow
          Action:
            - ssm:GetParameter
            - ssm:GetParameters
          Resource: arn:aws:ssm:eu-north-1:#{AWS::AccountId}:parameter/finance-tracker/default/db/*

custom:
  backendLayerArn: ${cf:finance-tracker-layer-service-default.BackendDepsLambdaLayerQualifiedArn}

functions:
  listAccounts:
    handler: apps/api/handlers/accounts.list_accounts
    timeout: 30
    memorySize: 512
    layers:
      - ${self:custom.backendLayerArn}
    events:
      - httpApi:
          path: /accounts
          method: GET

  createAccount:
    handler: apps/api/handlers/accounts.create_account
    timeout: 30
    memorySize: 512
    layers:
      - ${self:custom.backendLayerArn}
    events:
      - httpApi:
          path: /accounts
          method: POST

  updateAccount:
    handler: apps/api/handlers/accounts.update_account
    timeout: 30
    memorySize: 512
    layers:
      - ${self:custom.backendLayerArn}
    events:
      - httpApi:
          path: /accounts/{accountId}
          method: PATCH

  listCategories:
    handler: apps/api/handlers/categories.list_categories
    timeout: 30
    memorySize: 512
    layers:
      - ${self:custom.backendLayerArn}
    events:
      - httpApi:
          path: /categories
          method: GET

  createCategory:
    handler: apps/api/handlers/categories.create_category
    timeout: 30
    memorySize: 512
    layers:
      - ${self:custom.backendLayerArn}
    events:
      - httpApi:
          path: /categories
          method: POST

  updateCategory:
    handler: apps/api/handlers/categories.update_category
    timeout: 30
    memorySize: 512
    layers:
      - ${self:custom.backendLayerArn}
    events:
      - httpApi:
          path: /categories/{categoryId}
          method: PATCH

  listTransactions:
    handler: apps/api/handlers/transactions.list_transactions
    timeout: 30
    memorySize: 512
    layers:
      - ${self:custom.backendLayerArn}
    events:
      - httpApi:
          path: /transactions
          method: GET

  createTransaction:
    handler: apps/api/handlers/transactions.create_transaction
    timeout: 30
    memorySize: 512
    layers:
      - ${self:custom.backendLayerArn}
    events:
      - httpApi:
          path: /transactions
          method: POST

  createLoan:
    handler: apps/api/handlers/loans.create_loan
    timeout: 30
    memorySize: 512
    layers:
      - ${self:custom.backendLayerArn}
    events:
      - httpApi:
          path: /loans
          method: POST

  updateLoan:
    handler: apps/api/handlers/loans.update_loan
    timeout: 30
    memorySize: 512
    layers:
      - ${self:custom.backendLayerArn}
    events:
      - httpApi:
          path: /loans/{accountId}
          method: PATCH

  listLoanEvents:
    handler: apps/api/handlers/loans.list_loan_events
    timeout: 30
    memorySize: 512
    layers:
      - ${self:custom.backendLayerArn}
    events:
      - httpApi:
          path: /loans/{accountId}/events
          method: GET

  getLoanSchedule:
    handler: apps/api/handlers/loans.get_loan_schedule
    timeout: 30
    memorySize: 512
    layers:
      - ${self:custom.backendLayerArn}
    events:
      - httpApi:
          path: /loans/{accountId}/schedule
          method: GET

  monthlyReport:
    handler: apps/api/handlers/reporting.monthly_report
    timeout: 30
    memorySize: 512
    layers:
      - ${self:custom.backendLayerArn}
    events:
      - httpApi:
          path: /reports/monthly
          method: GET

  yearlyReport:
    handler: apps/api/handlers/reporting.yearly_report
    timeout: 30
    memorySize: 512
    layers:
      - ${self:custom.backendLayerArn}
    events:
      - httpApi:
          path: /reports/yearly
          method: GET

  totalReport:
    handler: apps/api/handlers/reporting.total_report
    timeout: 30
    memorySize: 512
    layers:
      - ${self:custom.backendLayerArn}
    events:
      - httpApi:
          path: /reports/total
          method: GET
